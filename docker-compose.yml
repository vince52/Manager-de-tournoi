version: '3'
services:
    front:
        container_name: front
        build: ./front
        depends_on:
            - back
        volumes:
          - ./node_project
        ports:
            - "8080:3000"
        restart: on-failure
    back:
        container_name: back
        build: ./back
        depends_on:
            - mongo
        networks:
            - back_net
        volumes:
          - ./node_project
        environment:
            - DB_HOST=db
            - DB_PORT=5432
            - DB_USER=postgres
            - DB_PASSWORD=password
            - DB_NAME=postgres
        ports:
            - "28000:28000"
        restart: on-failure
    mongo:
        container_name: mongo
        image: mongo
        environment:
            MONGO_INITDB_ROOT_USERNAME: admin
            MONGO_INITDB_ROOT_PASSWORD: adpass
            MONGO_INITDB_DATABASE: dbapp
        volumes:
            - db-data:/data/db
        networks:
            - back_net
        restart: on-failure
    mongo-express:
      image: mongo-express
      restart: always
      ports:
        - 8081:8081
      environment:
        ME_CONFIG_MONGODB_ADMINUSERNAME: admin
        ME_CONFIG_MONGODB_ADMINPASSWORD: adpass
      networks:
            - back_net
networks:
    back_net:
volumes:
    db-data: